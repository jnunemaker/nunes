<div class="card shadow-sm mb-4">
  <div class="card-header">
    Request Details
  </div>
  <div class="card-body">
    <dl class="row mb-0">
      <dt class="fw-normal col-12 col-md-2">Verb</dt>
      <dd class="col-12 col-md-10"><%= @waterfall.root.verb %></dd>

      <dt class="fw-normal col-12 col-md-2">Path</dt>
      <dd class="col-12 col-md-10">
        <span class="m-0 p-0 font-monospace small"><%= @waterfall.root.path %></span>
      </dd>

      <dt class="fw-normal col-12 col-md-2">Status</dt>
      <dd class="col-12 col-md-10">
        <span class="badge <%= @waterfall.root.status_css_class %> fw-normal">
          <%= @waterfall.root.status %>
        </span>
      </dd>

      <dt class="fw-normal col-12 col-md-2">Duration</dt>
      <dd class="col-12 col-md-10"><%= @waterfall.root.duration %>ms</dd>

      <dt class="fw-normal col-12 col-md-2">When</dt>
      <dd class="col-12 col-md-10"><%= compact_time_ago @waterfall.trace_started_at %></dd>

      <dt class="fw-normal col-12 col-md-2">IP</dt>
      <dd class="col-12 col-md-10"><%= @waterfall.root.ip %></dd>
    </dl>
  </div>
</div>

<div class="card shadow-sm mb-4">
  <div class="card-body">
    <table class="table">
      <thead>
        <tr>
          <th>Name</th>
          <th>&nbsp;</th>
          <th class="text-end">Time</th>
        </tr>
      </thead>
      <tbody>
        <% @waterfall.ordered.each do |span| %>
          <%
            offset = @waterfall.offset_for(span)
            color = @waterfall.color_for(span)
            width = @waterfall.width_for(span)
          %>
          <tr class="small">
            <td>
              <%= span.title %>
            </td>
            <td style="width: <%= @waterfall.width %>;">
              <div style="padding-left: <%= offset %>%;">
                <div class="rounded <%= color %>" style="width: <%= width %>%">&nbsp;</div>
              </div>
            </td>
            <td class="text-end">
              <%= span.duration %>ms
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    <%= debug @waterfall.ordered %>
  </div>
</div>
